THREE.OrbitControls=function(n,t){function dt(){return Math.PI/1800*i.autoRotateSpeed}function w(){return Math.pow(.95,i.zoomSpeed)}function it(n){e.theta-=n}function ht(n){e.phi-=n}function rt(n){i.object instanceof THREE.PerspectiveCamera?k/=n:i.object instanceof THREE.OrthographicCamera?(i.object.zoom=Math.max(i.minZoom,Math.min(i.maxZoom,i.object.zoom*n)),i.object.updateProjectionMatrix(),g=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),i.enableZoom=!1)}function ut(n){i.object instanceof THREE.PerspectiveCamera?k*=n:i.object instanceof THREE.OrthographicCamera?(i.object.zoom=Math.max(i.minZoom,Math.min(i.maxZoom,i.object.zoom/n)),i.object.updateProjectionMatrix(),g=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),i.enableZoom=!1)}function gt(n){o.set(n.clientX,n.clientY)}function ni(n){v.set(n.clientX,n.clientY)}function ti(n){c.set(n.clientX,n.clientY)}function ii(n){s.set(n.clientX,n.clientY);h.subVectors(s,o);var t=i.domElement===document?i.domElement.body:i.domElement;it(2*Math.PI*h.x/t.clientWidth*i.rotateSpeed);ht(2*Math.PI*h.y/t.clientHeight*i.rotateSpeed);o.copy(s);i.update()}function ri(n){y.set(n.clientX,n.clientY);p.subVectors(y,v);p.y>0?rt(w()):p.y<0&&ut(w());v.copy(y);i.update()}function ui(n){l.set(n.clientX,n.clientY);a.subVectors(l,c);b(a.x,a.y);c.copy(l);i.update()}function fi(){}function ei(n){n.deltaY<0?ut(w()):n.deltaY>0&&rt(w());i.update()}function oi(n){switch(n.keyCode){case i.keys.UP:b(0,i.keyPanSpeed);i.update();break;case i.keys.BOTTOM:b(0,-i.keyPanSpeed);i.update();break;case i.keys.LEFT:b(i.keyPanSpeed,0);i.update();break;case i.keys.RIGHT:b(-i.keyPanSpeed,0);i.update()}}function si(n){o.set(n.touches[0].pageX,n.touches[0].pageY)}function hi(n){var t=n.touches[0].pageX-n.touches[1].pageX,i=n.touches[0].pageY-n.touches[1].pageY,r=Math.sqrt(t*t+i*i);v.set(0,r)}function ci(n){c.set(n.touches[0].pageX,n.touches[0].pageY)}function li(n){s.set(n.touches[0].pageX,n.touches[0].pageY);h.subVectors(s,o);var t=i.domElement===document?i.domElement.body:i.domElement;it(2*Math.PI*h.x/t.clientWidth*i.rotateSpeed);ht(2*Math.PI*h.y/t.clientHeight*i.rotateSpeed);o.copy(s);i.update()}function ai(n){var t=n.touches[0].pageX-n.touches[1].pageX,r=n.touches[0].pageY-n.touches[1].pageY,u=Math.sqrt(t*t+r*r);y.set(0,u);p.subVectors(y,v);p.y>0?ut(w()):p.y<0&&rt(w());v.copy(y);i.update()}function vi(n){l.set(n.touches[0].pageX,n.touches[0].pageY);a.subVectors(l,c);b(a.x,a.y);c.copy(l);i.update()}function yi(){}function at(n){if(i.enabled!==!1){if(n.preventDefault(),n.button===i.mouseButtons.ORBIT){if(i.enableRotate===!1)return;gt(n);u=r.ROTATE}else if(n.button===i.mouseButtons.ZOOM){if(i.enableZoom===!1)return;ni(n);u=r.DOLLY}else if(n.button===i.mouseButtons.PAN){if(i.enablePan===!1)return;ti(n);u=r.PAN}u!==r.NONE&&(document.addEventListener("mousemove",ft,!1),document.addEventListener("mouseup",et,!1),i.dispatchEvent(nt))}}function ft(n){if(i.enabled!==!1)if(n.preventDefault(),u===r.ROTATE){if(i.enableRotate===!1)return;ii(n)}else if(u===r.DOLLY){if(i.enableZoom===!1)return;ri(n)}else if(u===r.PAN){if(i.enablePan===!1)return;ui(n)}}function et(n){i.enabled!==!1&&(fi(n),document.removeEventListener("mousemove",ft,!1),document.removeEventListener("mouseup",et,!1),i.dispatchEvent(tt),u=r.NONE)}function vt(n){i.enabled!==!1&&i.enableZoom!==!1&&(u===r.NONE||u===r.ROTATE)&&(n.preventDefault(),n.stopPropagation(),ei(n),i.dispatchEvent(nt),i.dispatchEvent(tt))}function yt(n){i.enabled!==!1&&i.enableKeys!==!1&&i.enablePan!==!1&&oi(n)}function pt(n){if(i.enabled!==!1){switch(n.touches.length){case 1:if(i.enableRotate===!1)return;si(n);u=r.TOUCH_ROTATE;break;case 2:if(i.enableZoom===!1)return;hi(n);u=r.TOUCH_DOLLY;break;case 3:if(i.enablePan===!1)return;ci(n);u=r.TOUCH_PAN;break;default:u=r.NONE}u!==r.NONE&&i.dispatchEvent(nt)}}function wt(n){if(i.enabled!==!1){n.preventDefault();n.stopPropagation();switch(n.touches.length){case 1:if(i.enableRotate===!1)return;if(u!==r.TOUCH_ROTATE)return;li(n);break;case 2:if(i.enableZoom===!1)return;if(u!==r.TOUCH_DOLLY)return;ai(n);break;case 3:if(i.enablePan===!1)return;if(u!==r.TOUCH_PAN)return;vi(n);break;default:u=r.NONE}}}function bt(n){i.enabled!==!1&&(yi(n),i.dispatchEvent(tt),u=r.NONE)}function kt(n){n.preventDefault()}this.object=n;this.domElement=t!==undefined?t:document;this.enabled=!0;this.target=new THREE.Vector3;this.minDistance=0;this.maxDistance=Infinity;this.minZoom=0;this.maxZoom=Infinity;this.minPolarAngle=0;this.maxPolarAngle=Math.PI;this.minAzimuthAngle=- Infinity;this.maxAzimuthAngle=Infinity;this.enableDamping=!1;this.dampingFactor=.25;this.enableZoom=!0;this.zoomSpeed=1;this.enableRotate=!0;this.rotateSpeed=1;this.enablePan=!0;this.keyPanSpeed=7;this.autoRotate=!1;this.autoRotateSpeed=2;this.enableKeys=!0;this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40};this.mouseButtons={ORBIT:THREE.MOUSE.LEFT,ZOOM:THREE.MOUSE.MIDDLE,PAN:THREE.MOUSE.RIGHT};this.target0=this.target.clone();this.position0=this.object.position.clone();this.zoom0=this.object.zoom;this.getPolarAngle=function(){return f.phi};this.getAzimuthalAngle=function(){return f.theta};this.reset=function(){i.target.copy(i.target0);i.object.position.copy(i.position0);i.object.zoom=i.zoom0;i.object.updateProjectionMatrix();i.dispatchEvent(ot);i.update();u=r.NONE};this.update=function(){var t=new THREE.Vector3,o=(new THREE.Quaternion).setFromUnitVectors(n.up,new THREE.Vector3(0,1,0)),c=o.clone().inverse(),s=new THREE.Vector3,h=new THREE.Quaternion;return function(){var n=i.object.position;return(t.copy(n).sub(i.target),t.applyQuaternion(o),f.setFromVector3(t),i.autoRotate&&u===r.NONE&&it(dt()),f.theta+=e.theta,f.phi+=e.phi,f.theta=Math.max(i.minAzimuthAngle,Math.min(i.maxAzimuthAngle,f.theta)),f.phi=Math.max(i.minPolarAngle,Math.min(i.maxPolarAngle,f.phi)),f.makeSafe(),f.radius*=k,f.radius=Math.max(i.minDistance,Math.min(i.maxDistance,f.radius)),i.target.add(d),t.setFromSpherical(f),t.applyQuaternion(c),n.copy(i.target).add(t),i.object.lookAt(i.target),i.enableDamping===!0?(e.theta*=1-i.dampingFactor,e.phi*=1-i.dampingFactor):e.set(0,0,0),k=1,d.set(0,0,0),g||s.distanceToSquared(i.object.position)>st||8*(1-h.dot(i.object.quaternion))>st)?(i.dispatchEvent(ot),s.copy(i.object.position),h.copy(i.object.quaternion),g=!1,!0):!1}}();this.dispose=function(){i.domElement.removeEventListener("contextmenu",kt,!1);i.domElement.removeEventListener("mousedown",at,!1);i.domElement.removeEventListener("wheel",vt,!1);i.domElement.removeEventListener("touchstart",pt,!1);i.domElement.removeEventListener("touchend",bt,!1);i.domElement.removeEventListener("touchmove",wt,!1);document.removeEventListener("mousemove",ft,!1);document.removeEventListener("mouseup",et,!1);window.removeEventListener("keydown",yt,!1)};var i=this,ot={type:"change"},nt={type:"start"},tt={type:"end"},r={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5},u=r.NONE,st=1e-6,f=new THREE.Spherical,e=new THREE.Spherical,k=1,d=new THREE.Vector3,g=!1,o=new THREE.Vector2,s=new THREE.Vector2,h=new THREE.Vector2,c=new THREE.Vector2,l=new THREE.Vector2,a=new THREE.Vector2,v=new THREE.Vector2,y=new THREE.Vector2,p=new THREE.Vector2;var ct=function(){var n=new THREE.Vector3;return function(t,i){n.setFromMatrixColumn(i,0);n.multiplyScalar(-t);d.add(n)}}(),lt=function(){var n=new THREE.Vector3;return function(t,i){n.setFromMatrixColumn(i,1);n.multiplyScalar(t);d.add(n)}}(),b=function(){var n=new THREE.Vector3;return function(t,r){var u=i.domElement===document?i.domElement.body:i.domElement,e,f;i.object instanceof THREE.PerspectiveCamera?(e=i.object.position,n.copy(e).sub(i.target),f=n.length(),f*=Math.tan(i.object.fov/2*Math.PI/180),ct(2*t*f/u.clientHeight,i.object.matrix),lt(2*r*f/u.clientHeight,i.object.matrix)):i.object instanceof THREE.OrthographicCamera?(ct(t*(i.object.right-i.object.left)/i.object.zoom/u.clientWidth,i.object.matrix),lt(r*(i.object.top-i.object.bottom)/i.object.zoom/u.clientHeight,i.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),i.enablePan=!1)}}();i.domElement.addEventListener("contextmenu",kt,!1);i.domElement.addEventListener("mousedown",at,!1);i.domElement.addEventListener("wheel",vt,!1);i.domElement.addEventListener("touchstart",pt,!1);i.domElement.addEventListener("touchend",bt,!1);i.domElement.addEventListener("touchmove",wt,!1);window.addEventListener("keydown",yt,!1);this.update()};THREE.OrbitControls.prototype=Object.create(THREE.EventDispatcher.prototype);THREE.OrbitControls.prototype.constructor=THREE.OrbitControls;Object.defineProperties(THREE.OrbitControls.prototype,{center:{get:function(){return console.warn("THREE.OrbitControls: .center has been renamed to .target"),this.target}},noZoom:{get:function(){return console.warn("THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),!this.enableZoom},set:function(n){console.warn("THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead.");this.enableZoom=!n}},noRotate:{get:function(){return console.warn("THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),!this.enableRotate},set:function(n){console.warn("THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead.");this.enableRotate=!n}},noPan:{get:function(){return console.warn("THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead."),!this.enablePan},set:function(n){console.warn("THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead.");this.enablePan=!n}},noKeys:{get:function(){return console.warn("THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),!this.enableKeys},set:function(n){console.warn("THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead.");this.enableKeys=!n}},staticMoving:{get:function(){return console.warn("THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),!this.enableDamping},set:function(n){console.warn("THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead.");this.enableDamping=!n}},dynamicDampingFactor:{get:function(){return console.warn("THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.dampingFactor},set:function(n){console.warn("THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead.");this.dampingFactor=n}}}),function(n){n.bt||(n.bt={});var t="bt-draw";n.bt.draw=function(t,i){var a=n.extend({},{controls:".js-bt-controls"},i),c=this,e=n(t),u,v,s,o,f,r,h,y=new THREE.BoxGeometry(1,1,1),p=new THREE.MeshLambertMaterial({color:65280}),w=new THREE.Mesh(y,p),b=function(n,t,i){var r=w.clone();return r.position.x=n*2,r.position.y=t*2,r.position.z=i*2,r},k=function(){var n,t,i,r;for(console.log("drawNet",u),s=new Array(u.LenZ),n=0;n<u.LenZ;n++)for(s[n]=new Array(u.LenY),t=0;t<u.LenY;t++)for(s[n][t]=new Array(u.LenX),i=0;i<u.LenX;i++)r=b(i,t,n),o.add(r),s[n][t][i]=r},l=function(){requestAnimationFrame(l,r.domElement);d()},d=function(){r.render(o,f)},g=function(){var n=e.innerWidth(),t=e.innerHeight();f.aspect=n/t;f.updateProjectionMatrix();r.setSize(n,t)},nt=function(){var i;v=n(a.controls);var u=e.innerWidth(),s=e.innerHeight(),t=1;o=new THREE.Scene;o.add(new THREE.AmbientLight(16777215,.3));i=new THREE.DirectionalLight(16777215,.35);i.position.set(1,1,1).normalize();o.add(i);f=new THREE.PerspectiveCamera(75,u/s,.1,1e3);f.position.set(0,t,t*3.5);r=new THREE.WebGLRenderer({antialias:!0,alpha:!1});r.setClearColor(7829367);r.setPixelRatio(window.devicePixelRatio);r.setSize(u,s);r.autoClear=!0;h=new THREE.OrbitControls(f);h.target.set(0,t,0);h.update();e.append(r.domElement);l();n(window).off("resize");n(window).on("resize",g);return c};return c.setConfig=function(n){u=n;k()},nt.call(this)};n.fn.btDraw=function(i,r){var u,f;return typeof i=="string"?(f=null,this.each(function(){return u=n.data(this,t),u&&typeof u[i]=="function"&&(f=u[i].call(u,r)),f}),f):this.each(function(){return u=new n.bt.draw(this,i),n.data(this,t,u),u})}}(jQuery),function(n){n.bt||(n.bt={});var t="bt-controls";n.bt.controls=function(t,i){var c=n.extend({},{draw:".js-bt-draw",url:""},i),l=this,f=n(t),r,e,u,o,s,a=function(n){if(console.log("sendRequest:",n),r.readyState===WebSocket.OPEN){var t=JSON.stringify(n);r.send(t)}else u.text("Connection is closed")},h=function(n,t){o.append('<div class="alert alert-danger">'+(t?"<b>"+t+":<\/b> ":"")+n+"<\/div>")},v=function(){a({Action:"getnetconfig"})},y=function(){u=n('<div class="bt-controls-status"><\/div>').appendTo(f);o=n('<div class="bt-controls-text"><\/div>').appendTo(f)},p=function(){var t,i;return y(),s=n(c.draw),t=f.data("url"),t||(i=window.location.host,t="ws://"+i+"/brain-torus"),r=new WebSocket(t),r.onopen=function(){u.text("connected");v()},r.onmessage=function(n){var t=JSON.parse(n.data);if(typeof t.Error!="undefined"&&t.Error)h(t.Error,t.Action);else switch(t.Action){case"getnetconfig":e=t;s.btDraw("setConfig",e)}},r.onerror=function(n){console.log(n);h(n.message)},r.onclose=function(){console.log(arguments);var t=arguments,n="";typeof arguments!==undefined&&arguments.length>0&&typeof arguments[0].reason!="undefined"&&(n=" reason: "+arguments[0].reason);u.text("disconnected."+n)},l};return p.call(this)};n.fn.btControls=function(i,r){var u,f;return typeof i=="string"?(f=null,this.each(function(){return u=n.data(this,t),u&&typeof u[i]=="function"&&(f=u[i].call(u,r)),f}),f):this.each(function(){return u=new n.bt.controls(this,i),n.data(this,t,u),u})}}(jQuery);$().ready(function(){$(".js-bt-draw").btDraw();$(".js-bt-controls").btControls()});