THREE.OrbitControls=function(n,t){function dt(){return Math.PI/1800*i.autoRotateSpeed}function w(){return Math.pow(.95,i.zoomSpeed)}function it(n){e.theta-=n}function ht(n){e.phi-=n}function rt(n){i.object instanceof THREE.PerspectiveCamera?k/=n:i.object instanceof THREE.OrthographicCamera?(i.object.zoom=Math.max(i.minZoom,Math.min(i.maxZoom,i.object.zoom*n)),i.object.updateProjectionMatrix(),g=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),i.enableZoom=!1)}function ut(n){i.object instanceof THREE.PerspectiveCamera?k*=n:i.object instanceof THREE.OrthographicCamera?(i.object.zoom=Math.max(i.minZoom,Math.min(i.maxZoom,i.object.zoom/n)),i.object.updateProjectionMatrix(),g=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),i.enableZoom=!1)}function gt(n){o.set(n.clientX,n.clientY)}function ni(n){v.set(n.clientX,n.clientY)}function ti(n){c.set(n.clientX,n.clientY)}function ii(n){s.set(n.clientX,n.clientY);h.subVectors(s,o);var t=i.domElement===document?i.domElement.body:i.domElement;it(2*Math.PI*h.x/t.clientWidth*i.rotateSpeed);ht(2*Math.PI*h.y/t.clientHeight*i.rotateSpeed);o.copy(s);i.update()}function ri(n){y.set(n.clientX,n.clientY);p.subVectors(y,v);p.y>0?rt(w()):p.y<0&&ut(w());v.copy(y);i.update()}function ui(n){l.set(n.clientX,n.clientY);a.subVectors(l,c);b(a.x,a.y);c.copy(l);i.update()}function fi(){}function ei(n){n.deltaY<0?ut(w()):n.deltaY>0&&rt(w());i.update()}function oi(n){switch(n.keyCode){case i.keys.UP:b(0,i.keyPanSpeed);i.update();break;case i.keys.BOTTOM:b(0,-i.keyPanSpeed);i.update();break;case i.keys.LEFT:b(i.keyPanSpeed,0);i.update();break;case i.keys.RIGHT:b(-i.keyPanSpeed,0);i.update()}}function si(n){o.set(n.touches[0].pageX,n.touches[0].pageY)}function hi(n){var t=n.touches[0].pageX-n.touches[1].pageX,i=n.touches[0].pageY-n.touches[1].pageY,r=Math.sqrt(t*t+i*i);v.set(0,r)}function ci(n){c.set(n.touches[0].pageX,n.touches[0].pageY)}function li(n){s.set(n.touches[0].pageX,n.touches[0].pageY);h.subVectors(s,o);var t=i.domElement===document?i.domElement.body:i.domElement;it(2*Math.PI*h.x/t.clientWidth*i.rotateSpeed);ht(2*Math.PI*h.y/t.clientHeight*i.rotateSpeed);o.copy(s);i.update()}function ai(n){var t=n.touches[0].pageX-n.touches[1].pageX,r=n.touches[0].pageY-n.touches[1].pageY,u=Math.sqrt(t*t+r*r);y.set(0,u);p.subVectors(y,v);p.y>0?ut(w()):p.y<0&&rt(w());v.copy(y);i.update()}function vi(n){l.set(n.touches[0].pageX,n.touches[0].pageY);a.subVectors(l,c);b(a.x,a.y);c.copy(l);i.update()}function yi(){}function at(n){if(i.enabled!==!1){if(n.preventDefault(),n.button===i.mouseButtons.ORBIT){if(i.enableRotate===!1)return;gt(n);u=r.ROTATE}else if(n.button===i.mouseButtons.ZOOM){if(i.enableZoom===!1)return;ni(n);u=r.DOLLY}else if(n.button===i.mouseButtons.PAN){if(i.enablePan===!1)return;ti(n);u=r.PAN}u!==r.NONE&&(document.addEventListener("mousemove",ft,!1),document.addEventListener("mouseup",et,!1),i.dispatchEvent(nt))}}function ft(n){if(i.enabled!==!1)if(n.preventDefault(),u===r.ROTATE){if(i.enableRotate===!1)return;ii(n)}else if(u===r.DOLLY){if(i.enableZoom===!1)return;ri(n)}else if(u===r.PAN){if(i.enablePan===!1)return;ui(n)}}function et(n){i.enabled!==!1&&(fi(n),document.removeEventListener("mousemove",ft,!1),document.removeEventListener("mouseup",et,!1),i.dispatchEvent(tt),u=r.NONE)}function vt(n){i.enabled!==!1&&i.enableZoom!==!1&&(u===r.NONE||u===r.ROTATE)&&(n.preventDefault(),n.stopPropagation(),ei(n),i.dispatchEvent(nt),i.dispatchEvent(tt))}function yt(n){i.enabled!==!1&&i.enableKeys!==!1&&i.enablePan!==!1&&oi(n)}function pt(n){if(i.enabled!==!1){switch(n.touches.length){case 1:if(i.enableRotate===!1)return;si(n);u=r.TOUCH_ROTATE;break;case 2:if(i.enableZoom===!1)return;hi(n);u=r.TOUCH_DOLLY;break;case 3:if(i.enablePan===!1)return;ci(n);u=r.TOUCH_PAN;break;default:u=r.NONE}u!==r.NONE&&i.dispatchEvent(nt)}}function wt(n){if(i.enabled!==!1){n.preventDefault();n.stopPropagation();switch(n.touches.length){case 1:if(i.enableRotate===!1)return;if(u!==r.TOUCH_ROTATE)return;li(n);break;case 2:if(i.enableZoom===!1)return;if(u!==r.TOUCH_DOLLY)return;ai(n);break;case 3:if(i.enablePan===!1)return;if(u!==r.TOUCH_PAN)return;vi(n);break;default:u=r.NONE}}}function bt(n){i.enabled!==!1&&(yi(n),i.dispatchEvent(tt),u=r.NONE)}function kt(n){n.preventDefault()}this.object=n;this.domElement=t!==undefined?t:document;this.enabled=!0;this.target=new THREE.Vector3;this.minDistance=0;this.maxDistance=Infinity;this.minZoom=0;this.maxZoom=Infinity;this.minPolarAngle=0;this.maxPolarAngle=Math.PI;this.minAzimuthAngle=- Infinity;this.maxAzimuthAngle=Infinity;this.enableDamping=!1;this.dampingFactor=.25;this.enableZoom=!0;this.zoomSpeed=1;this.enableRotate=!0;this.rotateSpeed=1;this.enablePan=!0;this.keyPanSpeed=7;this.autoRotate=!1;this.autoRotateSpeed=2;this.enableKeys=!0;this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40};this.mouseButtons={ORBIT:THREE.MOUSE.LEFT,ZOOM:THREE.MOUSE.MIDDLE,PAN:THREE.MOUSE.RIGHT};this.target0=this.target.clone();this.position0=this.object.position.clone();this.zoom0=this.object.zoom;this.getPolarAngle=function(){return f.phi};this.getAzimuthalAngle=function(){return f.theta};this.reset=function(){i.target.copy(i.target0);i.object.position.copy(i.position0);i.object.zoom=i.zoom0;i.object.updateProjectionMatrix();i.dispatchEvent(ot);i.update();u=r.NONE};this.update=function(){var t=new THREE.Vector3,o=(new THREE.Quaternion).setFromUnitVectors(n.up,new THREE.Vector3(0,1,0)),c=o.clone().inverse(),s=new THREE.Vector3,h=new THREE.Quaternion;return function(){var n=i.object.position;return(t.copy(n).sub(i.target),t.applyQuaternion(o),f.setFromVector3(t),i.autoRotate&&u===r.NONE&&it(dt()),f.theta+=e.theta,f.phi+=e.phi,f.theta=Math.max(i.minAzimuthAngle,Math.min(i.maxAzimuthAngle,f.theta)),f.phi=Math.max(i.minPolarAngle,Math.min(i.maxPolarAngle,f.phi)),f.makeSafe(),f.radius*=k,f.radius=Math.max(i.minDistance,Math.min(i.maxDistance,f.radius)),i.target.add(d),t.setFromSpherical(f),t.applyQuaternion(c),n.copy(i.target).add(t),i.object.lookAt(i.target),i.enableDamping===!0?(e.theta*=1-i.dampingFactor,e.phi*=1-i.dampingFactor):e.set(0,0,0),k=1,d.set(0,0,0),g||s.distanceToSquared(i.object.position)>st||8*(1-h.dot(i.object.quaternion))>st)?(i.dispatchEvent(ot),s.copy(i.object.position),h.copy(i.object.quaternion),g=!1,!0):!1}}();this.dispose=function(){i.domElement.removeEventListener("contextmenu",kt,!1);i.domElement.removeEventListener("mousedown",at,!1);i.domElement.removeEventListener("wheel",vt,!1);i.domElement.removeEventListener("touchstart",pt,!1);i.domElement.removeEventListener("touchend",bt,!1);i.domElement.removeEventListener("touchmove",wt,!1);document.removeEventListener("mousemove",ft,!1);document.removeEventListener("mouseup",et,!1);window.removeEventListener("keydown",yt,!1)};var i=this,ot={type:"change"},nt={type:"start"},tt={type:"end"},r={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5},u=r.NONE,st=1e-6,f=new THREE.Spherical,e=new THREE.Spherical,k=1,d=new THREE.Vector3,g=!1,o=new THREE.Vector2,s=new THREE.Vector2,h=new THREE.Vector2,c=new THREE.Vector2,l=new THREE.Vector2,a=new THREE.Vector2,v=new THREE.Vector2,y=new THREE.Vector2,p=new THREE.Vector2;var ct=function(){var n=new THREE.Vector3;return function(t,i){n.setFromMatrixColumn(i,0);n.multiplyScalar(-t);d.add(n)}}(),lt=function(){var n=new THREE.Vector3;return function(t,i){n.setFromMatrixColumn(i,1);n.multiplyScalar(t);d.add(n)}}(),b=function(){var n=new THREE.Vector3;return function(t,r){var u=i.domElement===document?i.domElement.body:i.domElement,e,f;i.object instanceof THREE.PerspectiveCamera?(e=i.object.position,n.copy(e).sub(i.target),f=n.length(),f*=Math.tan(i.object.fov/2*Math.PI/180),ct(2*t*f/u.clientHeight,i.object.matrix),lt(2*r*f/u.clientHeight,i.object.matrix)):i.object instanceof THREE.OrthographicCamera?(ct(t*(i.object.right-i.object.left)/i.object.zoom/u.clientWidth,i.object.matrix),lt(r*(i.object.top-i.object.bottom)/i.object.zoom/u.clientHeight,i.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),i.enablePan=!1)}}();i.domElement.addEventListener("contextmenu",kt,!1);i.domElement.addEventListener("mousedown",at,!1);i.domElement.addEventListener("wheel",vt,!1);i.domElement.addEventListener("touchstart",pt,!1);i.domElement.addEventListener("touchend",bt,!1);i.domElement.addEventListener("touchmove",wt,!1);window.addEventListener("keydown",yt,!1);this.update()};THREE.OrbitControls.prototype=Object.create(THREE.EventDispatcher.prototype);THREE.OrbitControls.prototype.constructor=THREE.OrbitControls;Object.defineProperties(THREE.OrbitControls.prototype,{center:{get:function(){return console.warn("THREE.OrbitControls: .center has been renamed to .target"),this.target}},noZoom:{get:function(){return console.warn("THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),!this.enableZoom},set:function(n){console.warn("THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead.");this.enableZoom=!n}},noRotate:{get:function(){return console.warn("THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),!this.enableRotate},set:function(n){console.warn("THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead.");this.enableRotate=!n}},noPan:{get:function(){return console.warn("THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead."),!this.enablePan},set:function(n){console.warn("THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead.");this.enablePan=!n}},noKeys:{get:function(){return console.warn("THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),!this.enableKeys},set:function(n){console.warn("THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead.");this.enableKeys=!n}},staticMoving:{get:function(){return console.warn("THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),!this.enableDamping},set:function(n){console.warn("THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead.");this.enableDamping=!n}},dynamicDampingFactor:{get:function(){return console.warn("THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.dampingFactor},set:function(n){console.warn("THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead.");this.dampingFactor=n}}}),function(n){"use strict";n.bt||(n.bt={});var t="bt-draw";n.bt.draw=function(t,i){var r=n.extend({},{controls:".js-bt-controls",factorX:4,factorY:4,factorZ:-4,summandX:1,summandY:1,summandZ:-1},i),p=this,l=n(t),u,d,g,a,c,f,o,w,k,b,e,s,h,v=function(n,t,i,r){var u=new THREE.Geometry,f;return f=r?new THREE.LineDashedMaterial({linewidth:1,color:i,dashSize:1,gapSize:1}):new THREE.LineBasicMaterial({linewidth:1,color:i}),u.vertices.push(n.clone()),u.vertices.push(t.clone()),u.computeLineDistances(),new THREE.Line(u,f,THREE.LineSegments)},rt=function(n){var t=new THREE.Object3D;return t.add(v(new THREE.Vector3(0,0,0),new THREE.Vector3(n,0,0),16711680,!1)),t.add(v(new THREE.Vector3(0,0,0),new THREE.Vector3(-n,0,0),16711680,!0)),t.add(v(new THREE.Vector3(0,0,0),new THREE.Vector3(0,n,0),65280,!1)),t.add(v(new THREE.Vector3(0,0,0),new THREE.Vector3(0,-n,0),65280,!0)),t.add(v(new THREE.Vector3(0,0,0),new THREE.Vector3(0,0,n),255,!1)),t.add(v(new THREE.Vector3(0,0,0),new THREE.Vector3(0,0,-n),255,!0)),t},ut=function(){return},nt=function(n,t,i){var r=t*i/n;return r>i?i:r},wt=function(){},ft=function(n){var i=-1,r=1,t;return(u.MaxWeight&&(r=u.MaxWeight),u.MinWeight&&(i=u.MinWeight),n>0)?(t=nt(r,n,255),t=(+Math.floor(t)).toString(16),t.length==1&&(t="0"+t),parseInt("0xff"+t+t)):(t=nt(-1*i,-1*n,255),t=(+Math.floor(t)).toString(16),t.length==1&&(t="0"+t),parseInt("0x"+t+t+"ff"))},et=function(n,t,i){var u=Math.floor(n/(t*i)),r,f;return n=n-u*t*i,r=Math.floor(n/t),f=n-r*t,{x:f,y:r,z:u}},ot=function(n){var f,i,e;for(n=n.Neurons,console.log("setNeurons",u,n),f=0;f<n.length;f++){var t=n[f],s=a[t.z][t.y][t.x],o=new THREE.Object3D;for(i=0;i<t.Neuron.Output.length;i++)e=et(t.Neuron.Output[i].n,u.LenX,u.LenY,u.LenZ),o.add(v(new THREE.Vector3(t.x*r.factorX+r.summandX,t.y*r.factorY+r.summandY,t.z*r.factorZ+r.summandZ),new THREE.Vector3(e.x*r.factorX+r.summandX,e.y*r.factorY+r.summandY,e.z*r.factorZ+r.summandZ),ft(t.Neuron.Output[i].w),!1));c.add(o)}},st=function(n,t,i){var f=new THREE.BoxGeometry(1,1,1),e=new THREE.MeshStandardMaterial({color:16777215,opacity:.3,transparent:!0}),u=new THREE.Mesh(f,e);return u.position.x=n*r.factorX+r.summandX,u.position.y=t*r.factorY+r.summandY,u.position.z=i*r.factorZ+r.summandZ,u},y=function(n){return{x:(n.x-r.summandX)/r.factorX,y:(n.y-r.summandY)/r.factorY,z:(n.z-r.summandZ)/r.factorZ}},bt=function(n){var t=y(n);try{return a[t.z][t.y][t.x]}catch(i){return null}},ht=function(){var n,t,i,r;for(console.log("drawNet",u),f.position.set(5.7033302189268404,-15.506568322186508,4.9197803014393395),w.update(),a=new Array(u.LenZ),n=0;n<u.LenZ;n++)for(a[n]=new Array(u.LenY),t=0;t<u.LenY;t++)for(a[n][t]=new Array(u.LenX),i=0;i<u.LenX;i++)r=st(i,t,n),c.add(r),a[n][t][i]=r},tt=function(){requestAnimationFrame(tt,o.domElement);ct();ut()},ct=function(){k.setFromCamera(b,f);var n=k.intersectObjects(c.children);n.length>0?e!=n[0].object&&(e&&e.material.emissive.setHex(e.currentHex),e=n[0].object,e.currentHex=e.material.emissive.getHex(),e.material.emissive.setHex(16711680)):(e&&e.material.emissive.setHex(e.currentHex),e=null);o.render(c,f)},lt=function(){var n=l.innerWidth(),t=l.innerHeight();f.aspect=n/t;f.updateProjectionMatrix();o.setSize(n,t)},at=function(){var n={firstN:null,secondN:null};s&&(n.firstN=y(s.position));h&&(n.secondN=y(h.position));d.btControls("fillSubscribeBlock",n)},it=function(n){var t,i,r,e,u,o,f,c;if(s&&(s.material.setValues(n),h))for(h.material.setValues(n),t=y(s.position),i=y(h.position),r=Math.min(t.z,i.z),e=Math.max(t.z,i.z);r<=e;r++)for(u=Math.min(t.y,i.y),o=Math.max(t.y,i.y);u<=o;u++)for(f=Math.min(t.x,i.x),c=Math.max(t.x,i.x);f<=c;f++)a[r][u][f].material.setValues(n)},vt=function(){e&&(it({transparent:!0}),s&&h?(s=e,h=null):s?h=e:(s=e,h=null),it({transparent:!1}),at())},yt=function(n){b.x=n.clientX/window.innerWidth*2-1;b.y=-(n.clientY/window.innerHeight)*2+1},pt=function(){var t;d=n(r.controls);g=n(".js-bt-camera-info");var i=l.innerWidth(),u=l.innerHeight(),e=1;c=new THREE.Scene;c.add(new THREE.AmbientLight(16777215,.3));t=new THREE.DirectionalLight(16777215,.35);t.position.set(1,1,1).normalize();c.add(t);f=new THREE.PerspectiveCamera(75,i/u,.1,1e3);f.position.set(0,e,e*3.5);o=new THREE.WebGLRenderer({antialias:!0,alpha:!1});o.setClearColor(16777215);o.setPixelRatio(window.devicePixelRatio);o.setSize(i,u);o.autoClear=!0;k=new THREE.Raycaster;b=new THREE.Vector2;l.on("mousemove",yt);l.on("click",vt);w=new THREE.OrbitControls(f,o.domElement);w.target.set(0,0,0);w.update();l.append(o.domElement);c.add(rt(1e3));tt();n(window).off("resize");n(window).on("resize",lt);return p};return p.setConfig=function(n){u=n;ht()},p.setNeurons=function(n){ot(n)},pt.call(p)};n.fn.btDraw=function(i,r){var u,f;return typeof i=="string"?(f=null,this.each(function(){return u=n.data(this,t),u&&typeof u[i]=="function"&&(f=u[i].call(u,r)),f}),f):this.each(function(){return u=new n.bt.draw(this,i),n.data(this,t,u),u})}}(jQuery),function(n){"use strict";n.bt||(n.bt={});var t="bt-controls";n.bt.controls=function(t,i){var y=n.extend({},{draw:".js-bt-draw"},i),o=this,f=n(t),u,h,e,c,s,r={},l=function(n){if(console.log("sendRequest:",n),u.readyState===WebSocket.OPEN){var t=JSON.stringify(n);u.send(t)}else e.text("Connection is closed")},a=function(n,t){c.append('<div class="alert alert-danger">'+(t?"<b>"+t+":<\/b> ":"")+n+"<\/div>")},p=function(){l({Action:"getnetconfig"})},w=function(n){console.log("subscribe");l({Action:"subscribe",ArgsInt:n})},v=function(){r.MinX.val("");r.MinY.val("");r.MinZ.val("");r.MaxX.val("");r.MaxY.val("");r.MaxZ.val("");r.Button.prop("disabled",!0)},b=function(n){v();n.firstN&&(r.MinX.val(n.firstN.x),r.MinY.val(n.firstN.y),r.MinZ.val(n.firstN.z));n.secondN&&(r.MaxX.val(n.secondN.x),r.MaxY.val(n.secondN.y),r.MaxZ.val(n.secondN.z));n.firstN&&n.secondN&&r.Button.prop("disabled",!1)},k=function(){r.Form=n('<form class="subscribe"><\/form>').on("submit",function(){return!1}).appendTo(f);r.MinX=n('<input name="ArgsInt" />').appendTo(r.Form);r.MinY=n('<input name="ArgsInt" />').appendTo(r.Form);r.MinZ=n('<input name="ArgsInt" />').appendTo(r.Form);r.MaxX=n('<input name="ArgsInt" />').appendTo(r.Form);r.MaxY=n('<input name="ArgsInt" />').appendTo(r.Form);r.MaxZ=n('<input name="ArgsInt" />').appendTo(r.Form);r.Button=n('<button class="btn btn-primary">Subscribe<\/button>').on("click",function(){var n=[r.MinX.val(),r.MinY.val(),r.MinZ.val(),r.MaxX.val(),r.MaxY.val(),r.MaxZ.val(),];return w(n),!1}).appendTo(r.Form);v();e=n('<div class="bt-controls-status"><\/div>').appendTo(f);c=n('<div class="bt-controls-text"><\/div>').appendTo(f)},d=function(){var i,t,r;return k(),s=n(y.draw),i=100123123123,console.log("LongTest:",i,i+1),t=f.data("url"),t||(r=window.location.host,t="ws://"+r+"/brain-torus"),u=new WebSocket(t),u.onopen=function(){e.text("connected");p()},u.onmessage=function(n){var t=JSON.parse(n.data);if(typeof t.Error!="undefined"&&t.Error)a(t.Error,t.Action);else switch(t.Action){case"getnetconfig":h=t;s.btDraw("setConfig",h);break;case"subscribe":s.btDraw("setNeurons",t)}},u.onerror=function(n){console.log(n);a(n.message)},u.onclose=function(){console.log(arguments);var t=arguments,n="";typeof arguments!==undefined&&arguments.length>0&&typeof arguments[0].reason!="undefined"&&(n=" reason: "+arguments[0].reason);e.text("disconnected."+n)},o};return o.fillSubscribeBlock=function(n){b(n)},d.call(o)};n.fn.btControls=function(i,r){var u,f;return typeof i=="string"?(f=null,this.each(function(){return u=n.data(this,t),u&&typeof u[i]=="function"&&(f=u[i].call(u,r)),f}),f):this.each(function(){return u=new n.bt.controls(this,i),n.data(this,t,u),u})}}(jQuery),function(n){"use strict";n().ready(function(){n(".js-bt-draw").btDraw({controls:".js-bt-controls"});n(".js-bt-controls").btControls({draw:".js-bt-draw"})})}(jQuery);